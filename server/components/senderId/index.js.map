{"version":3,"sources":["components/senderId/index.js"],"names":["SenderId","notifyAdminSenderIdApproval","senderId","User","find","where","admin","then","user","reject","message","text","name","company","PLAY_URL","id","userId","createSenderId","findAll","senderIds","promise","newObj","createdBy","updatedBy","length","create","blockedSenderId","filter","x","status","approvedSenderId","data","resolve","getSenderId","attributes","userSenderId"],"mappings":";;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AAEA,IAAMA,WAAW;AACfC,6BADe,uCACaC,QADb,EACuB;AACpC,WAAO,gBAAGC,IAAH,CAAQC,IAAR,CAAa,EAAEC,OAAO,EAAEC,OAAO,CAAT,EAAT,EAAb,EACJC,IADI,CACC,UAACC,IAAD,EAAU;AACd,UAAI,CAACA,IAAL,EAAW,OAAO,kBAAQC,MAAR,CAAe,EAAEC,SAAS,qBAAX,EAAf,CAAP;AACX,UAAMC,+BAA6BT,SAASU,IAAtC,WAAgDV,SAASW,OAAzD,UACJ,sBAAOC,QADH,kBACwBZ,SAASa,EADvC;AAEA,aAAO,iCAAoB,EAAEC,QAAQR,KAAKO,EAAf,EAAmBJ,UAAnB,EAApB,CAAP;AACD,KANI,CAAP;AAOD,GATc;AAUfM,gBAVe,0BAUAf,QAVA,EAUUc,MAVV,EAUkB;AAC/B,WAAO,gBAAGhB,QAAH,CAAYkB,OAAZ,CAAoB,EAAEb,OAAO,EAAEO,MAAMV,QAAR,EAAT,EAApB,EACJK,IADI,CACC,UAACY,SAAD,EAAe;AACnB,UAAIC,gBAAJ;AACA,UAAMC,SAAS,EAAEC,WAAWN,MAAb,EAAqBO,WAAWP,MAAhC,EAAwCJ,MAAMV,QAA9C,EAAf;AACA,UAAI,CAACiB,UAAUK,MAAf,EAAuBJ,UAAU,gBAAGpB,QAAH,CAAYyB,MAAZ,CAAmBJ,MAAnB,CAAV;;AAEvB,UAAMK,kBAAkBP,UAAUQ,MAAV,CAAiB;AAAA,eAAMC,EAAEC,MAAF,KAAa,CAAnB;AAAA,OAAjB,EAAwC,CAAxC,CAAxB;AACA,UAAMC,mBAAmBX,UAAUQ,MAAV,CAAiB;AAAA,eAAMC,EAAEC,MAAF,KAAa,CAAnB;AAAA,OAAjB,EAAwC,CAAxC,CAAzB;AACA,UAAI,CAACH,eAAD,IAAoBI,gBAAxB,EAA0C;AACxCV,kBAAU,gBAAGpB,QAAH,CAAYyB,MAAZ,CAAmB,sBAAcJ,MAAd,EAAsB;AACjDQ,kBAAQC,iBAAiBD;AADwB,SAAtB,CAAnB,CAAV;AAGD;AACD,UAAI,CAACT,OAAL,EAAcA,UAAU,gBAAGpB,QAAH,CAAYyB,MAAZ,CAAmBJ,MAAnB,CAAV;AACd,aAAOD,QACJb,IADI,CACC,UAACwB,IAAD,EAAU;AACd/B,iBAASC,2BAAT,CAAqCC,QAArC;AACA,eAAO,kBAAQ8B,OAAR,CAAgBD,IAAhB,CAAP;AACD,OAJI,CAAP;AAKD,KAnBI,CAAP;AAoBD,GA/Bc;AAgCfE,aAhCe,uBAgCH/B,QAhCG,EAgCOc,MAhCP,EAgCe;AAC5B,WAAO,gBAAGhB,QAAH,CAAYI,IAAZ,CAAiB;AACtB8B,kBAAY,CAAC,IAAD,EAAO,MAAP,EAAe,kBAAf,CADU;AAEtB7B,aAAO,EAAEO,MAAMV,QAAR,EAAkBoB,WAAWN,MAA7B;AAFe,KAAjB,EAGJT,IAHI,CAGC,UAAC4B,YAAD,EAAkB;AACxB,UAAI,CAACA,YAAL,EAAmB,OAAOnC,SAASiB,cAAT,CAAwBf,QAAxB,EAAkCc,MAAlC,CAAP;AACnB,aAAO,kBAAQgB,OAAR,CAAgBG,YAAhB,CAAP;AACD,KANM,CAAP;AAOD;AAxCc,CAAjB;;kBA2CenC,Q","file":"index.js","sourcesContent":["import db from '../../conn/sqldb';\nimport config from '../../config/environment';\nimport { notifyOnUserChannel } from '../../components/notify';\n\nconst SenderId = {\n  notifyAdminSenderIdApproval(senderId) {\n    return db.User.find({ where: { admin: 2 } })\n      .then((user) => {\n        if (!user) return Promise.reject({ message: 'No admin user found' });\n        const text = `Request to approve ${senderId.name} - ${senderId.company}. ${\n          config.PLAY_URL}/senderId/${senderId.id}`;\n        return notifyOnUserChannel({ userId: user.id, text });\n      });\n  },\n  createSenderId(senderId, userId) {\n    return db.SenderId.findAll({ where: { name: senderId } })\n      .then((senderIds) => {\n        let promise;\n        const newObj = { createdBy: userId, updatedBy: userId, name: senderId };\n        if (!senderIds.length) promise = db.SenderId.create(newObj);\n\n        const blockedSenderId = senderIds.filter(x => (x.status === 3))[0];\n        const approvedSenderId = senderIds.filter(x => (x.status === 2))[0];\n        if (!blockedSenderId && approvedSenderId) {\n          promise = db.SenderId.create(Object.assign(newObj, {\n            status: approvedSenderId.status,\n          }));\n        }\n        if (!promise) promise = db.SenderId.create(newObj);\n        return promise\n          .then((data) => {\n            SenderId.notifyAdminSenderIdApproval(senderId);\n            return Promise.resolve(data);\n          });\n      });\n  },\n  getSenderId(senderId, userId) {\n    return db.SenderId.find({\n      attributes: ['id', 'name', 'senderIdStatusId'],\n      where: { name: senderId, createdBy: userId },\n    }).then((userSenderId) => {\n      if (!userSenderId) return SenderId.createSenderId(senderId, userId);\n      return Promise.resolve(userSenderId);\n    });\n  },\n};\n\nexport default SenderId;\n"]}